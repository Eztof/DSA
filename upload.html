<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>DSA Daten hochladen</title>
</head>
<body>
  <h1>DSA JSON Upload zu Firestore</h1>
  <input type="file" id="jsonFile" accept=".json">
  <button onclick="uploadJson()">Hochladen</button>
  <pre id="status"></pre>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBHIftX5AvSJaPAiUIek0TBVjEtxwZo7Ow",
      authDomain: "dsapp-6722f.firebaseapp.com",
      databaseURL: "https://dsapp-6722f-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "dsapp-6722f",
      storageBucket: "dsapp-6722f.appspot.com",
      messagingSenderId: "693149967345",
      appId: "1:693149967345:web:aa784c1aa1aa105f0c5a50",
      measurementId: "G-LJLLMTX2GT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.uploadJson = async function () {
      const fileInput = document.getElementById('jsonFile');
      const status = document.getElementById('status');

      if (!fileInput.files.length) {
        status.textContent = "Bitte eine JSON-Datei ausw√§hlen.";
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();

      reader.onload = async function (event) {
        try {
          const data = JSON.parse(event.target.result);
          status.textContent = "Daten werden hochgeladen...";

          for (const [collectionName, items] of Object.entries(data)) {
            for (const item of items) {
              const docRef = doc(collection(db, collectionName));
              await setDoc(docRef, item);
            }
          }

          status.textContent = "Upload erfolgreich!";
        } catch (err) {
          console.error(err);
          status.textContent = "Fehler beim Hochladen: " + err.message;
        }
      };

      reader.readAsText(file);
    };
  </script>
</body>
</html>
